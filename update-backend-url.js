// update-backend-url.js
import ngrok from 'ngrok';
import fs from 'fs';
import path from 'path';

const CONFIG_PATH = path.resolve('./src/config.ts');

async function startTunnels() {
  try {
    // 1) Ngrok tunnel for your Node/Express backend on port 4000
    const backendUrl = await ngrok.connect({
      addr: 4000,
      authtoken_from_env: true, // uses NGROK_AUTHTOKEN from env
    });

    // 2) Ngrok tunnel for your FastAPI tagger on port 8000
    const taggerUrl = await ngrok.connect({
      addr: 8000,
      authtoken_from_env: true,
    });

    // 3) Write both URLs into src/config.ts
    const configContent =
      "// This file is auto-generated by update-backend-url.js\n\n" +
      `export const BACKEND_URL = '${backendUrl}';\n` +
      `export const TAGGER_URL  = '${taggerUrl}';\n`;

    fs.writeFileSync(CONFIG_PATH, configContent);
    console.log(`‚úÖ Node/Express backend is at ${backendUrl}`);
    console.log(`‚úÖ FastAPI tagger is at ${taggerUrl}`);
    console.log(`üîß Updated ${CONFIG_PATH}`);
  } catch (err) {
    console.error("‚ùå Failed to start ngrok tunnels:", err);
    process.exit(1);
  }
}

startTunnels();
